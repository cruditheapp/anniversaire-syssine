<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üîç Dossier Classifi√© ‚Äî Affaire n¬∞1302</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<style>
:root {
  --papier: #f5ebe0;
  --papier-chaud: #efe0cc;
  --kraft: #e6d5b8;
  --parchemin: #faf6f0;
  --encre: #2c1810;
  --encre-douce: #4a3728;
  --sepia: #6b4c3b;
  --sepia-clair: #8b6f5e;
  --sang: #8b1a1a;
  --sang-clair: #a52a2a;
  --tampon: #c0392b;
  --or-vieux: #9c7a3c;
  --cafe: #6f4e37;
  --reussite: #2d6a4f;
  --indice-bg: #eef7f2;
  --indice-bord: #52b788;
  /* Aliases for JS inline styles that reference old vars */
  --teal: var(--reussite);
  --or-pale: var(--or-vieux);
  --corail: var(--tampon);
  --noir: var(--papier);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; overflow-x: hidden; }
body {
  font-family: 'Crimson Pro', Georgia, serif;
  background: var(--papier); color: var(--encre);
  min-height: 100vh; overflow-x: hidden;
}
body::before {
  content: ''; position: fixed; inset: 0; z-index: -1; pointer-events: none;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E") repeat;
}

#intro-screen {
  position: fixed; inset: 0; z-index: 1000;
  background: radial-gradient(ellipse at 30% 70%, rgba(111,78,55,0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 30%, rgba(156,122,60,0.06) 0%, transparent 50%),
    linear-gradient(175deg, var(--kraft) 0%, var(--papier-chaud) 50%, var(--papier) 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  cursor: pointer; transition: opacity 1.2s ease, transform 1.2s ease;
  box-shadow: inset 0 0 80px rgba(111,78,55,0.12);
}
#intro-screen.fade-out { opacity: 0; transform: scale(1.05); pointer-events: none; }
.stamp-classified {
  font-family: 'Special Elite', monospace; font-size: clamp(2rem, 6vw, 4.5rem);
  color: var(--tampon); border: 4px solid var(--tampon);
  padding: 0.3em 0.8em; transform: rotate(-8deg);
  letter-spacing: 0.15em; text-transform: uppercase;
  animation: stamp-appear 0.6s cubic-bezier(0.17, 0.67, 0.29, 1.2) forwards;
  opacity: 0; text-shadow: 1px 1px 0 rgba(192,57,43,0.2);
  box-shadow: 2px 2px 8px rgba(139,26,26,0.1);
}
@keyframes stamp-appear { 0% { opacity:0; transform:rotate(-8deg) scale(3); } 60% { opacity:1; transform:rotate(-8deg) scale(0.95); } 100% { opacity:1; transform:rotate(-8deg) scale(1); } }
.dossier-number { font-family: 'Special Elite', monospace; font-size: clamp(1rem,3vw,1.6rem); color: var(--sepia); margin-top: 1.5rem; letter-spacing: 0.3em; opacity: 0; animation: fade-in 1s ease 0.8s forwards; }
.intro-instruction { font-family: 'Crimson Pro', serif; font-size: clamp(0.85rem,2vw,1.1rem); color: var(--sepia-clair); margin-top: 3rem; letter-spacing: 0.15em; opacity: 0; animation: pulse-fade 2s ease 1.5s infinite; }
@keyframes fade-in { to { opacity: 1; } }
@keyframes pulse-fade { 0%,100% { opacity:0.4; } 50% { opacity:0.8; } }

#main-content { opacity: 0; transition: opacity 1s ease; }
#main-content.visible { opacity: 1; }

.crime-scene {
  min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 2rem; position: relative;
  background: radial-gradient(ellipse at 85% 15%, rgba(111,78,55,0.1) 0%, transparent 25%),
    radial-gradient(ellipse at 12% 85%, rgba(111,78,55,0.07) 0%, transparent 20%),
    linear-gradient(175deg, var(--papier) 0%, var(--papier-chaud) 60%, var(--kraft) 100%);
  overflow: hidden;
}
.crime-scene::before { content:''; position:absolute; inset:0; background: repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(156,122,60,0.06) 39px, rgba(156,122,60,0.06) 40px); pointer-events: none; }
.police-tape {
  position: absolute; top: 0; left: -5%; width: 110%;
  background: repeating-linear-gradient(90deg, #e8c93a 0px, #e8c93a 80px, #2c1810 80px, #2c1810 100px);
  color: #2c1810; font-family: 'Special Elite', monospace; font-size: 0.85rem;
  letter-spacing: 0.3em; text-transform: uppercase; padding: 0.4em 0;
  text-align: center; transform: rotate(-1deg); z-index: 5; overflow: hidden; white-space: nowrap;
  box-shadow: 0 2px 6px rgba(44,24,16,0.15);
}
.police-tape span { display: inline-block; animation: scroll-tape 20s linear infinite; }
@keyframes scroll-tape { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

.crime-title { font-family:'Playfair Display',serif; font-size:clamp(2rem,7vw,5rem); font-weight:700; text-align:center; line-height:1.15; margin-bottom:0.5em; position:relative; z-index:2; }
.crime-title .line1 { display:block; color:var(--sang-clair); font-style:italic; font-weight:400; font-size:0.5em; letter-spacing:0.2em; text-transform:uppercase; }
.crime-title .line2 { display:block; color:var(--encre); }
.crime-title .line3 { display:block; color:var(--tampon); font-size:0.4em; font-family:'Special Elite',monospace; letter-spacing:0.25em; margin-top:0.3em; }
.crime-date { font-family:'Special Elite',monospace; color:var(--or-vieux); font-size:clamp(0.9rem,2vw,1.2rem); letter-spacing:0.15em; margin-bottom:2rem; z-index:2; }
.crime-narrative { max-width:700px; text-align:center; font-size:clamp(1rem,2.5vw,1.25rem); line-height:1.8; color:var(--encre-douce); z-index:2; margin-bottom:2.5rem; font-weight:300; }
.crime-narrative em { color:var(--tampon); font-weight:400; }
.crime-narrative strong { color:var(--encre); font-weight:600; }
.btn-enquete { font-family:'Special Elite',monospace; font-size:clamp(1rem,2.5vw,1.3rem); color:var(--parchemin); background:var(--sang-clair); border:none; padding:0.8em 2.5em; cursor:pointer; letter-spacing:0.15em; text-transform:uppercase; z-index:2; transition:all 0.3s; box-shadow:0 3px 10px rgba(139,26,26,0.2); }
.btn-enquete:hover { transform:scale(1.05); background:var(--sang); box-shadow:0 5px 20px rgba(139,26,26,0.3); }

.enquete-section { display:none; padding:2rem 1rem; max-width:800px; margin:0 auto; }
.enquete-section.active { display:block; animation:section-in 0.8s ease forwards; }
@keyframes section-in { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:translateY(0); } }

.evidence-card { background:var(--parchemin); border:1px solid rgba(156,122,60,0.25); padding:2rem; margin:2rem 0; position:relative; overflow:hidden; box-shadow:0 2px 12px rgba(44,24,16,0.08), inset 0 0 40px rgba(111,78,55,0.04); }
.evidence-card::before { content:''; position:absolute; top:0; left:0; width:4px; height:100%; background:linear-gradient(to bottom, var(--tampon), var(--sang)); }
.evidence-card::after { content:'PI√àCE √Ä CONVICTION'; position:absolute; top:0.8rem; right:1rem; font-family:'Special Elite',monospace; font-size:0.65rem; color:var(--tampon); letter-spacing:0.2em; opacity:0.4; }
.evidence-number { font-family:'Special Elite',monospace; font-size:0.8rem; color:var(--tampon); letter-spacing:0.3em; text-transform:uppercase; margin-bottom:1rem; }
.evidence-title { font-family:'Playfair Display',serif; font-size:clamp(1.3rem,3vw,1.8rem); color:var(--encre); margin-bottom:1rem; font-weight:700; }
.evidence-text { font-size:1.05rem; line-height:1.8; color:var(--encre-douce); font-weight:300; margin-bottom:1.5rem; }
.evidence-text em { color:var(--sang-clair); font-weight:400; }

.enigme-zone { background:rgba(230,213,184,0.3); border:1px dashed var(--or-vieux); padding:1.5rem; margin:1.5rem 0; text-align:center; }
.enigme-label { font-family:'Special Elite',monospace; font-size:0.75rem; color:var(--or-vieux); letter-spacing:0.25em; text-transform:uppercase; margin-bottom:1rem; }
.enigme-question { font-family:'Playfair Display',serif; font-size:clamp(1.05rem,2.5vw,1.3rem); color:var(--encre); margin-bottom:1.5rem; line-height:1.6; font-style:italic; }
.input-group { display:flex; gap:0.5rem; max-width:450px; margin:0 auto; flex-wrap:wrap; justify-content:center; }
.enigme-input { font-family:'Special Elite',monospace; font-size:1.1rem; padding:0.7em 1.2em; background:white; border:1px solid var(--or-vieux); color:var(--encre); flex:1; min-width:180px; text-align:center; letter-spacing:0.1em; transition:border-color 0.3s; }
.enigme-input:focus { outline:none; border-color:var(--sang-clair); box-shadow:0 0 12px rgba(165,42,42,0.1); }
.enigme-input::placeholder { color:rgba(44,24,16,0.3); }
.btn-valider { font-family:'Special Elite',monospace; font-size:0.9rem; padding:0.7em 1.5em; background:var(--sang-clair); color:var(--parchemin); border:none; cursor:pointer; letter-spacing:0.15em; text-transform:uppercase; transition:all 0.3s; }
.btn-valider:hover { background:var(--sang); transform:scale(1.03); }
.feedback { font-family:'Special Elite',monospace; font-size:0.9rem; margin-top:1rem; min-height:1.5em; }
.feedback.error { color:var(--tampon); animation:shake 0.4s ease; }
.feedback.success { color:var(--reussite); }
.feedback.hint { color:var(--or-vieux); font-style:italic; }
@keyframes shake { 0%,100%{transform:translateX(0);} 20%,60%{transform:translateX(-5px);} 40%,80%{transform:translateX(5px);} }

.choices-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin:1.5rem 0; }
.choice-btn { font-family:'Crimson Pro',serif; font-size:1rem; padding:1em 1.2em; background:white; border:1px solid rgba(156,122,60,0.3); color:var(--encre); cursor:pointer; transition:all 0.3s; text-align:left; line-height:1.5; box-shadow:0 1px 4px rgba(44,24,16,0.06); }
.choice-btn:hover { border-color:var(--sang-clair); transform:translateY(-2px); box-shadow:0 3px 10px rgba(44,24,16,0.1); }
.choice-btn.correct { background:var(--indice-bg); border-color:var(--reussite); color:var(--reussite); }
.choice-btn.wrong { background:#fef2f2; border-color:var(--tampon); color:var(--tampon); opacity:0.6; }

.indice-unlocked { display:none; padding:1.5rem; margin-top:1.5rem; text-align:center; background:var(--indice-bg); border:1px solid var(--indice-bord); }
.indice-unlocked.show { display:block; animation:unlock-glow 1s ease; }
@keyframes unlock-glow { 0%{box-shadow:0 0 0 rgba(82,183,136,0);opacity:0;transform:scale(0.95);} 50%{box-shadow:0 0 20px rgba(82,183,136,0.15);} 100%{box-shadow:0 0 0 rgba(82,183,136,0);opacity:1;transform:scale(1);} }
.indice-label { font-family:'Special Elite',monospace; font-size:0.7rem; color:var(--reussite); letter-spacing:0.3em; text-transform:uppercase; margin-bottom:0.8rem; }
.indice-content { font-family:'Playfair Display',serif; font-size:1.15rem; color:var(--encre); font-style:italic; }

.btn-continuer { display:none; margin:2rem auto; font-family:'Special Elite',monospace; font-size:1rem; padding:0.8em 2em; background:transparent; border:1px solid var(--sepia); color:var(--sepia); cursor:pointer; letter-spacing:0.2em; text-transform:uppercase; transition:all 0.3s; }
.btn-continuer.show { display:block; animation:fade-in 0.5s ease forwards; }
.btn-continuer:hover { background:rgba(107,76,59,0.06); box-shadow:0 0 15px rgba(107,76,59,0.1); }

.progress-bar { position:fixed; top:0; left:0; height:3px; background:linear-gradient(90deg,var(--sang),var(--tampon),var(--or-vieux)); z-index:100; transition:width 0.8s cubic-bezier(0.23,1,0.32,1); box-shadow:0 0 8px rgba(165,42,42,0.3); }
.indices-collectes { position:fixed; top:50%; right:0; transform:translateY(-50%); z-index:50; display:flex; flex-direction:column; gap:0.5rem; padding:0.5rem; }
.indice-dot { width:12px; height:12px; border-radius:50%; border:2px solid rgba(156,122,60,0.3); background:transparent; transition:all 0.5s; }
.indice-dot.found { background:var(--or-vieux); border-color:var(--or-vieux); box-shadow:0 0 8px rgba(156,122,60,0.4); }

.cipher-display { font-family:'Special Elite',monospace; font-size:clamp(1rem,3vw,1.5rem); color:var(--encre); letter-spacing:0.15em; margin:1rem 0; padding:1rem; background:white; border:1px solid rgba(156,122,60,0.2); line-height:1.8; box-shadow:inset 0 1px 4px rgba(44,24,16,0.05); }
.hint-btn { font-family:'Special Elite',monospace; font-size:0.75rem; color:var(--sepia-clair); background:none; border:none; cursor:pointer; letter-spacing:0.15em; opacity:0.5; transition:opacity 0.3s; margin-top:0.5rem; }
.hint-btn:hover { opacity:1; text-decoration:underline; }

.letter-grid { display:inline-grid; grid-template-columns:repeat(8,1fr); gap:5px; margin:1rem auto; max-width:420px; }
.letter-cell { font-family:'Special Elite',monospace; font-size:clamp(0.9rem,2.5vw,1.3rem); width:clamp(34px,7vw,46px); height:clamp(34px,7vw,46px); display:flex; align-items:center; justify-content:center; background:white; border:1px solid rgba(156,122,60,0.2); color:var(--encre); transition:all 0.3s; user-select:none; cursor:pointer; }
.letter-cell:hover { border-color:var(--sang-clair); background:#fef8f5; }
.letter-cell.highlight { border-color:var(--tampon); color:var(--tampon); background:#fef2f2; }
.letter-cell.dim { opacity:0.2; }
.letter-cell.path-reveal { border-color:var(--reussite); color:var(--reussite); background:var(--indice-bg); font-weight:600; }

.suspect-table { width:100%; border-collapse:collapse; margin:1rem 0; font-family:'Crimson Pro',serif; font-size:0.95rem; }
.suspect-table th { font-family:'Special Elite',monospace; font-size:0.7rem; color:var(--or-vieux); letter-spacing:0.2em; text-transform:uppercase; padding:0.8rem 0.5rem; border-bottom:1px solid var(--or-vieux); text-align:left; }
.suspect-table td { padding:0.7rem 0.5rem; border-bottom:1px solid rgba(156,122,60,0.12); color:var(--encre-douce); vertical-align:top; }
.suspect-table tr:hover td { background:rgba(230,213,184,0.2); }
.attempt-counter { font-family:'Special Elite',monospace; font-size:0.75rem; color:var(--sepia-clair); margin-top:0.5rem; opacity:0.5; }

.blood-drip { position:absolute; width:2px; background:linear-gradient(to bottom, rgba(165,42,42,0.2), transparent); top:0; animation:drip 4s ease-in infinite; opacity:0.4; }
@keyframes drip { 0%{height:0;opacity:0.4;} 70%{height:60px;opacity:0.4;} 100%{height:70px;opacity:0;} }

#finale { display:none; min-height:100vh; position:relative; overflow:hidden; }
#finale.active { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:2rem; animation:finale-in 1.5s ease forwards; }
@keyframes finale-in { from{opacity:0;} to{opacity:1;} }
.finale-bg { position:absolute; inset:0; background: radial-gradient(ellipse at 30% 40%, rgba(255,185,175,0.12) 0%, transparent 50%), radial-gradient(ellipse at 70% 60%, rgba(255,215,160,0.08) 0%, transparent 50%), linear-gradient(175deg, var(--papier) 0%, var(--papier-chaud) 50%, var(--kraft) 100%); }
.confetti-container { position:absolute; inset:0; pointer-events:none; overflow:hidden; }
.confetti { position:absolute; width:10px; height:10px; top:-10px; animation:confetti-fall linear infinite; }
@keyframes confetti-fall { 0%{transform:translateY(-10px) rotate(0deg);opacity:1;} 100%{transform:translateY(110vh) rotate(720deg);opacity:0;} }
.finale-content { position:relative; z-index:2; text-align:center; max-width:700px; }
.finale-badge { display:inline-block; font-family:'Special Elite',monospace; font-size:0.75rem; color:var(--reussite); letter-spacing:0.4em; text-transform:uppercase; border:1px solid var(--reussite); padding:0.4em 1.5em; margin-bottom:2rem; animation:pulse-border 2s ease infinite; }
@keyframes pulse-border { 0%,100%{border-color:rgba(45,106,79,0.4);} 50%{border-color:rgba(45,106,79,0.8);} }
.finale-title { font-family:'Playfair Display',serif; font-size:clamp(2.5rem,8vw,5rem); font-weight:700; line-height:1.1; margin-bottom:1rem; color:var(--encre); }
.finale-subtitle { font-family:'Playfair Display',serif; font-size:clamp(1.3rem,3vw,1.8rem); font-style:italic; color:var(--sang-clair); margin-bottom:2.5rem; font-weight:400; }
.cadeau-reveal { background:white; border:2px solid var(--or-vieux); padding:2.5rem; margin:1.5rem auto; position:relative; max-width:550px; box-shadow:0 4px 20px rgba(44,24,16,0.1); }
.cadeau-reveal::before { content:'üé≠'; position:absolute; top:-1.2rem; left:50%; transform:translateX(-50%); font-size:2rem; background:var(--papier); padding:0 0.5em; }
.cadeau-label { font-family:'Special Elite',monospace; font-size:0.7rem; color:var(--or-vieux); letter-spacing:0.4em; text-transform:uppercase; margin-bottom:1.5rem; }
.cadeau-titre { font-family:'Playfair Display',serif; font-size:clamp(1.8rem,4vw,2.8rem); font-weight:700; color:var(--encre); margin-bottom:0.5rem; line-height:1.2; }
.cadeau-details { font-family:'Crimson Pro',serif; font-size:1.2rem; color:var(--sepia); margin-bottom:0.3rem; font-weight:300; }
.cadeau-date { font-family:'Special Elite',monospace; font-size:1.3rem; color:var(--tampon); margin-top:1rem; letter-spacing:0.1em; }
.finale-message { font-family:'Crimson Pro',serif; font-size:clamp(1.05rem,2.5vw,1.25rem); color:var(--encre-douce); line-height:1.8; margin-top:2.5rem; font-weight:300; max-width:550px; margin-left:auto; margin-right:auto; }
.finale-message em { color:var(--sang-clair); font-weight:400; }
.signature { font-family:'Playfair Display',serif; font-size:1.4rem; font-style:italic; color:var(--encre); margin-top:2rem; font-weight:700; }
.heart-float { position:absolute; font-size:1.5rem; animation:float-heart 6s ease-in-out infinite; opacity:0.25; }
@keyframes float-heart { 0%,100%{transform:translateY(0) rotate(0deg);opacity:0.1;} 50%{transform:translateY(-30px) rotate(15deg);opacity:0.3;} }

@media (max-width:600px) { .evidence-card{padding:1.2rem;} .evidence-card::after{display:none;} .enigme-zone{padding:1rem;} .cadeau-reveal{padding:1.5rem;} .indices-collectes{display:none;} .choices-grid{grid-template-columns:1fr;} .suspect-table{font-size:0.85rem;} .letter-grid{gap:3px;} }
</style>
</head>
<body>

<!-- INTRO -->
<div id="intro-screen" onclick="openDossier()">
  <div class="stamp-classified">CLASSIFI√â</div>
  <div class="dossier-number">Dossier n¬∞13-02 ‚Äî Brigade Criminelle des Antilles</div>
  <div class="intro-instruction">‚ñ∏ Cliquez pour ouvrir le dossier ‚óÇ</div>
</div>

<div class="progress-bar" id="progressBar" style="width: 0%"></div>
<div class="indices-collectes">
  <div class="indice-dot" id="dot1"></div>
  <div class="indice-dot" id="dot2"></div>
  <div class="indice-dot" id="dot3"></div>
  <div class="indice-dot" id="dot4"></div>
</div>

<div id="main-content">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SC√àNE DE CRIME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="crime-scene" id="scene">
    <div class="police-tape">
      <span>‚ö† SC√àNE DE CRIME ‚Äî NE PAS FRANCHIR ‚ö† SC√àNE DE CRIME ‚Äî NE PAS FRANCHIR ‚ö† SC√àNE DE CRIME ‚Äî NE PAS FRANCHIR ‚ö† SC√àNE DE CRIME ‚Äî NE PAS FRANCHIR ‚ö†&nbsp;&nbsp;&nbsp;</span>
    </div>
    <div class="blood-drip" style="left: 15%;"></div>
    <div class="blood-drip" style="left: 45%; animation-delay: 1.5s;"></div>
    <div class="blood-drip" style="left: 78%; animation-delay: 3s;"></div>

    <h1 class="crime-title">
      <span class="line1">Affaire non r√©solue</span>
      <span class="line2">Meurtre Myst√©rieux<br>√† la Saint-Valentin</span>
      <span class="line3">Fort-de-France ‚Äî 13 f√©vrier 2026 ‚Äî 23h59</span>
    </h1>
    <p class="crime-date">üìÇ Agent¬∑e assign√©¬∑e : Inspectrice Syssine</p>
    <div class="crime-narrative">
      <p>La nuit du <strong>13 f√©vrier</strong>, √† la veille de la Saint-Valentin, un crime passionnel a √©t√© commis sur la Savane de Fort-de-France. L'<em>Amour</em> a √©t√© retrouv√© sans vie au pied de la statue de l'Imp√©ratrice Jos√©phine.</p>
      <br>
      <p>Deux t√©moins f√©lins ont √©t√© aper√ßus sur les lieux. Quatre suspects martiniquais ont √©t√© arr√™t√©s. Tous mentent, sauf un.</p>
      <br>
      <p>Tous les enqu√™teurs de la Brigade ont √©chou√©. <em>Vous √™tes notre dernier espoir, Inspectrice.</em></p>
    </div>
    <button class="btn-enquete" onclick="startEnquete()">üîç Ouvrir l'enqu√™te</button>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 1 ‚Äî CHIFFRE DE C√âSAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="enquete-section" id="enigme1">
    <div class="evidence-card">
      <div class="evidence-number">Pi√®ce √† conviction n¬∞1</div>
      <div class="evidence-title">Le Billet Chiffr√© de Manman Dlo</div>
      <div class="evidence-text">
        Un billet froiss√© a √©t√© retrouv√© dans la fontaine de la Place de la Savane, flottant entre deux n√©nuphars. L'√©criture est celle de <em>Manman Dlo</em>, la sir√®ne gardienne des eaux martiniquaises. Elle a chiffr√© le nom des deux t√©moins f√©lins √† l'aide d'un <em>chiffre de C√©sar</em>.<br><br>
        L'indice laiss√© par Manman Dlo : <em>¬´ La cl√© se trouve dans le jour de naissance de celle qui enqu√™te. ¬ª</em>
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">üîê Message intercept√©</div>
        <div class="cipher-display" id="cipher1"></div>
        <div class="enigme-question">
          D√©chiffrez les noms des deux t√©moins f√©lins.<br>
          <small style="color: var(--or); opacity: 0.5;">Le chiffre de C√©sar d√©cale chaque lettre dans l'alphabet.</small>
        </div>
        <div class="input-group">
          <input type="text" class="enigme-input" id="answer1" placeholder="Les deux noms..." autocomplete="off" spellcheck="false">
          <button class="btn-valider" onclick="checkEnigme1()">D√©chiffrer</button>
        </div>
        <button class="hint-btn" onclick="showHint(1)">üí° Besoin d'un indice ?</button>
        <div class="feedback" id="feedback1"></div>
        <div class="attempt-counter" id="attempts1"></div>
      </div>

      <div class="indice-unlocked" id="indice1">
        <div class="indice-label">üóù Fragment n¬∞1 d√©bloqu√©</div>
        <div class="indice-content">C _ _ _&ensp;&ensp;_ _&ensp;&ensp;_ _ _ _</div>
      </div>
    </div>
    <button class="btn-continuer" id="btn-next1" onclick="goTo('enigme2')">Pi√®ce √† conviction suivante ‚Üí</button>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 2 ‚Äî D√âDUCTION LOGIQUE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="enquete-section" id="enigme2">
    <div class="evidence-card">
      <div class="evidence-number">Pi√®ce √† conviction n¬∞2</div>
      <div class="evidence-title">Le T√©moignage de Ti-Jean</div>
      <div class="evidence-text">
        Le l√©gendaire <em>Ti-Jean</em>, h√©ros rus√© des contes cr√©oles, a interrog√© les quatre suspects. Chacun fait exactement <em>une d√©claration vraie et une fausse</em>. √Ä vous de d√©m√™ler le vrai du faux, Inspectrice.
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">üìã Proc√®s-verbaux d'interrogatoire</div>

        <table class="suspect-table">
          <tr><th>Suspect</th><th>D√©claration 1</th><th>D√©claration 2</th></tr>
          <tr>
            <td style="color: var(--tampon); font-weight: 600;">üêç B√™te √† Man Ib√®</td>
            <td>¬´ Le crime a eu lieu sur la plage des Salines. ¬ª</td>
            <td>¬´ La Diablesse portait des chaussures rouges. ¬ª</td>
          </tr>
          <tr>
            <td style="color: var(--tampon); font-weight: 600;">üë† La Diablesse</td>
            <td>¬´ Je portais des chaussures blanches. ¬ª</td>
            <td>¬´ La B√™te √† Man Ib√® √©tait chez le Dorlis. ¬ª</td>
          </tr>
          <tr>
            <td style="color: var(--tampon); font-weight: 600;">üåô Le Dorlis</td>
            <td>¬´ La B√™te √† Man Ib√® n'√©tait pas chez moi. ¬ª</td>
            <td>¬´ Le crime a eu lieu sur la Savane. ¬ª</td>
          </tr>
          <tr>
            <td style="color: var(--tampon); font-weight: 600;">üî• Le Volcan</td>
            <td>¬´ La Diablesse portait des chaussures rouges. ¬ª</td>
            <td>¬´ J'ai vu le Dorlis sur la plage des Salines. ¬ª</td>
          </tr>
        </table>

        <div class="enigme-question" style="margin-top: 1.5rem;">
          On sait que le crime a eu lieu <strong>sur la Savane</strong>, pas sur la plage.<br><br>
          D'apr√®s vos d√©ductions : <strong>de quelle couleur √©taient les chaussures de la Diablesse ?</strong>
        </div>

        <div class="choices-grid" id="choices2">
          <button class="choice-btn" onclick="checkEnigme2(this, 'rouge')">üî¥ Rouges</button>
          <button class="choice-btn" onclick="checkEnigme2(this, 'blanc')">‚ö™ Blanches</button>
          <button class="choice-btn" onclick="checkEnigme2(this, 'noir')">‚ö´ Noires</button>
          <button class="choice-btn" onclick="checkEnigme2(this, 'or')">üü° Dor√©es</button>
        </div>
        <div class="feedback" id="feedback2"></div>
      </div>

      <div class="indice-unlocked" id="indice2">
        <div class="indice-label">üóù Fragment n¬∞2 d√©bloqu√©</div>
        <div class="indice-content">_ _ L L&ensp;&ensp;M _&ensp;&ensp;_ _ _ _</div>
      </div>
    </div>
    <button class="btn-continuer" id="btn-next2" onclick="goTo('enigme3')">Pi√®ce √† conviction suivante ‚Üí</button>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 3 ‚Äî GRILLE DE MOTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="enquete-section" id="enigme3">
    <div class="evidence-card">
      <div class="evidence-number">Pi√®ce √† conviction n¬∞3</div>
      <div class="evidence-title">La Grille du Quimboiseur</div>
      <div class="evidence-text">
        Le <em>Quimboiseur</em> du Morne-Rouge a grav√© une grille de lettres sur un mur de la sc√®ne de crime. Il affirme qu'un <em>mot secret de 8 lettres</em> est dissimul√© √† l'int√©rieur ‚Äî comme dans un jeu de mots m√™l√©s, les lettres sont align√©es en ligne droite : horizontale, verticale ou diagonale. Attention aux fausses pistes.
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">üîÆ La grille ensorcel√©e</div>
        <div class="letter-grid" id="letterGrid"></div>
        <div style="font-size: 0.8rem; color: var(--or); opacity: 0.4; margin: 0.5rem 0;">Cliquez les lettres dans l'ordre ou tapez directement.</div>
        <div class="enigme-question">
          Quel mot de 8 lettres se cache dans cette grille ?
        </div>
        <div class="input-group">
          <input type="text" class="enigme-input" id="answer3" placeholder="Le mot secret..." autocomplete="off" maxlength="12" spellcheck="false">
          <button class="btn-valider" onclick="checkEnigme3()">V√©rifier</button>
        </div>
        <button class="hint-btn" onclick="showHint(3)">üí° Besoin d'un indice ?</button>
        <div class="feedback" id="feedback3"></div>
      </div>

      <div class="indice-unlocked" id="indice3">
        <div class="indice-label">üóù Fragment n¬∞3 d√©bloqu√©</div>
        <div class="indice-content">_ A _ _&ensp;&ensp;_ E&ensp;&ensp;L _ _ _</div>
      </div>
    </div>
    <button class="btn-continuer" id="btn-next3" onclick="goTo('enigme4')">Derni√®re pi√®ce √† conviction ‚Üí</button>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 4 ‚Äî RECONSTITUTION FINALE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="enquete-section" id="enigme4">
    <div class="evidence-card">
      <div class="evidence-number">Pi√®ce √† conviction n¬∞4 ‚Äî Finale</div>
      <div class="evidence-title">Le Coffre de l'Habitation Cl√©ment</div>
      <div class="evidence-text">
        Un ancien coffre colonial a √©t√© d√©couvert dans les caves de l'<em>Habitation Cl√©ment</em>. √Ä l'int√©rieur, un parchemin porte les trois fragments que vous avez collect√©s. Assemblez-les pour reconstituer le <em>nom secret</em> que cache cette affaire.
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">üóù Vos trois fragments superpos√©s</div>
        <div id="fragmentsDisplay"></div>

        <div class="enigme-question">
          ¬´ <em>Le premier fragment r√©v√®le le d√©but.<br>
          Le deuxi√®me fragment r√©v√®le le c≈ìur.<br>
          Le troisi√®me fragment r√©v√®le la fin.</em> ¬ª<br><br>
          Reconstituez le nom complet. Trois mots.
        </div>
        <div class="input-group">
          <input type="text" class="enigme-input" id="answer4" placeholder="Le secret..." autocomplete="off" spellcheck="false">
          <button class="btn-valider" onclick="checkEnigme4()">Ouvrir le coffre</button>
        </div>
        <button class="hint-btn" onclick="showHint(4)">üí° Dernier indice ?</button>
        <div class="feedback" id="feedback4"></div>
        <div class="attempt-counter" id="attempts4"></div>
      </div>
    </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FINALE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section id="finale">
    <div class="finale-bg"></div>
    <div class="confetti-container" id="confettiContainer"></div>
    <div class="finale-content">
      <div class="finale-badge">‚ú¶ AFFAIRE CLASS√âE ‚ú¶</div>
      <h2 class="finale-title">Joyeux Anniversaire Syssine !</h2>
      <p class="finale-subtitle">L'enqu√™trice la plus brillante des Antilles üîç</p>

      <div class="cadeau-reveal">
        <div class="cadeau-label">‚ú¶ TON CADEAU D'ANNIVERSAIRE ‚ú¶</div>
        <div class="cadeau-titre">üé≠ Call Me Ludo</div>
        <div class="cadeau-details">Spectacle vivant</div>
        <div class="cadeau-date">üìÖ 1er Avril 2026</div>
      </div>

      <div class="finale-message">
        <p>Ma ch√®re Jessie,</p>
        <br>
        <p>Tu pensais r√©soudre un crime, mais c'√©tait en fait une <em>d√©claration d'amiti√©</em> d√©guis√©e en enqu√™te polici√®re. üïµÔ∏è‚Äç‚ôÄÔ∏è</p>
        <br>
        <p>Pour tes <strong style="color: var(--or-vieux);">ann√©es de folie, de rire et de complicit√©</strong>, tu m√©rites une soir√©e aussi extraordinaire que toi.</p>
        <br>
        <p>Pr√©pare-toi pour le <strong style="color: var(--or-vieux);">1er avril 2026</strong> ‚Äî et non, ce n'est <em>pas</em> un poisson d'avril. üêüüòâ</p>
        <br>
        <p class="signature">C'est ce que m√©rite une Queen Badass comme toi ! üëëüî•</p>
      </div>
    </div>
  </section>

</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let indicesFound = 0;
let hintCounts = {1:0, 2:0, 3:0, 4:0};
let attempts = {1:0, 4:0};
let fragmentsRevealed = [false, false, false];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ENIGME 1 ‚Äî C√©sar shift=13
// "MAGE ET ISIS" ‚Üí shift each letter +13:
// M(12)+13=Z(25), A(0)+13=N(13), G(6)+13=T(19), E(4)+13=R(17) ‚Üí ZNTR
// E(4)+13=R(17), T(19)+13=G(6) ‚Üí RG
// I(8)+13=V(21), S(18)+13=F(5), I(8)+13=V(21), S(18)+13=F(5) ‚Üí VFVF
// Encrypted: "ZNTR RG VFVF"
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const CIPHER_TEXT = "ZNTR  RG  VFVF";
const CLEAR_TEXT = "MAGE ET ISIS";

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('cipher1').textContent = CIPHER_TEXT;
  buildLetterGrid();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INTRO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDossier() {
  const intro = document.getElementById('intro-screen');
  intro.classList.add('fade-out');
  setTimeout(() => { intro.style.display = 'none'; document.getElementById('main-content').classList.add('visible'); }, 1200);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startEnquete() {
  document.getElementById('scene').style.display = 'none';
  document.getElementById('enigme1').classList.add('active');
  updateProgress();
}
function goTo(id) {
  document.querySelectorAll('.enquete-section').forEach(s => { s.classList.remove('active'); s.style.display = 'none'; });
  const t = document.getElementById(id);
  t.style.display = 'block'; void t.offsetWidth; t.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
  updateProgress();
  if (id === 'enigme4') renderFragments();
}
function updateProgress() { document.getElementById('progressBar').style.width = (indicesFound / 4 * 100) + '%'; }
function unlockIndice(n) {
  indicesFound++;
  fragmentsRevealed[n - 1] = true;
  document.getElementById('indice' + n).classList.add('show');
  document.getElementById('dot' + n).classList.add('found');
  const btn = document.getElementById('btn-next' + n);
  if (btn) btn.classList.add('show');
  updateProgress();
}
function disableInput(id) {
  const inp = document.getElementById(id);
  inp.disabled = true; inp.style.opacity = '0.5';
  const btn = inp.parentElement.querySelector('.btn-valider');
  if (btn) { btn.disabled = true; btn.style.opacity = '0.5'; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 1 ‚Äî C√©sar ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkEnigme1() {
  const raw = document.getElementById('answer1').value.trim().toUpperCase().replace(/[^A-Z ]/g, '').replace(/\s+/g, ' ');
  const fb = document.getElementById('feedback1');
  attempts[1]++;

  if (raw === 'MAGE ET ISIS' || raw === 'MAGE ISIS' || raw === 'ISIS ET MAGE' || raw === 'ISIS MAGE') {
    fb.textContent = '‚úÖ Mage & Isis ! Les deux f√©lins t√©moins sont identifi√©s.';
    fb.className = 'feedback success';
    unlockIndice(1);
    disableInput('answer1');
  } else if (raw.includes('MAGE') || raw.includes('ISIS')) {
    fb.textContent = 'üî• Vous avez trouv√© un des deux noms ! Il en manque un...';
    fb.className = 'feedback hint';
  } else {
    if (attempts[1] >= 5) {
      fb.textContent = 'üí° Z‚ÜíM, N‚ÜíA, T‚ÜíG, R‚ÜíE. Le premier nom est M-A-G-E...';
    } else if (attempts[1] >= 3) {
      fb.textContent = '‚ùå Chaque lettre recule de 13 positions. Z(26) - 13 = M(13)...';
    } else {
      fb.textContent = '‚ùå Pas encore. La cl√© est le jour de naissance : le 13. D√©calez chaque lettre de 13 positions en arri√®re.';
    }
    fb.className = 'feedback error';
  }
  document.getElementById('attempts1').textContent = 'Tentative ' + attempts[1];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 2 ‚Äî Logique ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Raisonnement:
// FAIT: crime = Savane (pas plage)
// B√™te: D1("plage")=FAUX ‚Üí D2("Diablesse chaussures rouges")=VRAI
// Diablesse: D1("blanches") ‚Üí si rouges=vrai ‚Üí D1=FAUX ‚Üí D2("B√™te chez Dorlis")=VRAI
// Dorlis: D1("B√™te PAS chez moi") ‚Üí si B√™te chez Dorlis=vrai ‚Üí D1=FAUX ‚Üí D2("crime Savane")=VRAI ‚úì
// Volcan: D1("rouges")=VRAI ‚Üí D2("Dorlis sur plage")=FAUX ‚úì
// ‚Üí ROUGES

function checkEnigme2(btn, choice) {
  const fb = document.getElementById('feedback2');
  const all = document.querySelectorAll('#choices2 .choice-btn');
  if (choice === 'rouge') {
    btn.classList.add('correct');
    fb.innerHTML = '‚úÖ Brillant ! B√™te dit FAUX sur la plage ‚Üí VRAI sur les chaussures rouges. La Diablesse dit FAUX sur blanches ‚Üí VRAI sur "B√™te chez Dorlis". Tout s\'encha√Æne.';
    fb.className = 'feedback success';
    all.forEach(b => { if (b !== btn) b.classList.add('wrong'); b.style.pointerEvents = 'none'; });
    unlockIndice(2);
  } else {
    btn.classList.add('wrong'); btn.style.pointerEvents = 'none';
    hintCounts[2]++;
    if (choice === 'blanc') fb.textContent = '‚ùå Si blanches, la Diablesse dit vrai (D1). Alors D2 est fausse. V√©rifiez si tout reste coh√©rent avec le Dorlis...';
    else if (choice === 'noir') fb.textContent = '‚ùå Le noir n\'appara√Æt dans aucun t√©moignage. Partez de B√™te √† Man Ib√® : sa D1 est fausse (crime ‚â† plage), donc sa D2 est...';
    else fb.textContent = '‚ùå Le dor√© n\'appara√Æt nulle part. Commencez par ce qu\'on sait : le crime = Savane. Qui ment sur √ßa ?';
    fb.className = 'feedback error';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 3 ‚Äî Grille "LIMONADE" ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 8x8 grid. LIMONADE hidden in a zigzag non-aligned path.
// Path (row,col):
// L(0,5) ‚Üí I(1,3) ‚Üí M(2,6) ‚Üí O(3,4) ‚Üí N(4,1) ‚Üí A(5,7) ‚Üí D(6,0) ‚Üí E(7,5)
// Completely scattered, no alignment.

// LIMONADE on the main diagonal (0,0)‚Üí(7,7)
// Decoys: "LIME" starts at (0,0) horizontally but leads nowhere useful
// "MONDE" appears vertically col 2 rows 2-6 to mislead
// Several L, I, M scattered as red herrings
const GRID_LETTERS = [
  ['L','I','M','E','T','P','V','N'],
  ['D','I','F','K','H','L','B','U'],
  ['G','Q','M','E','W','O','C','R'],
  ['X','S','B','O','P','D','T','A'],
  ['H','E','J','A','N','U','K','I'],
  ['F','P','W','R','C','A','S','M'],
  ['T','B','N','G','I','L','D','F'],
  ['O','K','S','H','R','O','J','E'],
];

// Clean diagonal top-left ‚Üí bottom-right
const GRID_PATH = [[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7]];

function buildLetterGrid() {
  const grid = document.getElementById('letterGrid');
  if (!grid) return;
  grid.innerHTML = '';
  for (let r = 0; r < 8; r++) {
    for (let c = 0; c < 8; c++) {
      const cell = document.createElement('div');
      cell.className = 'letter-cell';
      cell.textContent = GRID_LETTERS[r][c];
      cell.dataset.row = r; cell.dataset.col = c;
      cell.addEventListener('click', () => toggleCell(cell));
      grid.appendChild(cell);
    }
  }
}

let selectedCells = [];
function toggleCell(cell) {
  if (cell.classList.contains('highlight')) {
    cell.classList.remove('highlight');
    selectedCells = selectedCells.filter(x => x.el !== cell);
  } else {
    cell.classList.add('highlight');
    selectedCells.push({ el: cell, letter: cell.textContent });
  }
  document.getElementById('answer3').value = selectedCells.map(x => x.letter).join('');
}

function checkEnigme3() {
  const answer = document.getElementById('answer3').value.trim().toUpperCase();
  const fb = document.getElementById('feedback3');

  if (answer === 'LIMONADE') {
    fb.textContent = '‚úÖ LIMONADE ! Le Quimboiseur l√®ve son sortil√®ge. Vous avancez.';
    fb.className = 'feedback success';
    unlockIndice(3);
    disableInput('answer3');
    // Reveal path
    const grid = document.getElementById('letterGrid');
    const cells = grid.querySelectorAll('.letter-cell');
    cells.forEach(cell => {
      const r = parseInt(cell.dataset.row), c = parseInt(cell.dataset.col);
      const onPath = GRID_PATH.some(p => p[0] === r && p[1] === c);
      cell.classList.remove('highlight');
      if (onPath) cell.classList.add('path-reveal');
      else cell.classList.add('dim');
    });
  } else {
    hintCounts[3]++;
    if (hintCounts[3] >= 5) {
      fb.textContent = 'üí°üí° Le mot est L-I-M-O-N-A-D-E. Cherchez une diagonale !';
    } else if (hintCounts[3] >= 3) {
      fb.textContent = '‚ùå 8 lettres. Pensez √† une boisson rafra√Æchissante. Commence par L, finit par E.';
    } else {
      fb.textContent = '‚ùå Ce n\'est pas le bon mot. 8 lettres ‚Äî cherchez en horizontal, vertical ou diagonal.';
    }
    fb.className = 'feedback error';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê √âNIGME 4 ‚Äî Reconstitution ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// "CALL ME LUDO" = C A L L   M E   L U D O
// Fragment 1: C _ _ _   _ _   _ _ _ _  (only C)
// Fragment 2: _ _ L L   M _   _ _ _ _  (L, L, M)
// Fragment 3: _ A _ _   _ E   L _ _ _  (A, E, L)
// Missing after all 3: U, D, O (last 3 of LUDO)

function renderFragments() {
  const display = document.getElementById('fragmentsDisplay');
  if (!display) return;
  //           C  A  L  L     M  E     L  U  D  O
  const full = ['C','A','L','L',' ','M','E',' ','L','U','D','O'];
  const m1 =   [ 1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0];
  const m2 =   [ 0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0];
  const m3 =   [ 0,  1,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0];

  let html = full.map((ch, i) => {
    if (ch === ' ') return '&ensp;&ensp;';
    let show = false;
    if (fragmentsRevealed[0] && m1[i]) show = true;
    if (fragmentsRevealed[1] && m2[i]) show = true;
    if (fragmentsRevealed[2] && m3[i]) show = true;
    return show
      ? `<span style="color:var(--reussite);font-weight:600;">${ch}</span>`
      : `<span style="color:var(--sang-clair);">_</span>`;
  }).join(' ');

  display.innerHTML = `<div class="cipher-display" style="font-size:clamp(1.4rem,4vw,2.2rem);letter-spacing:0.25em;">${html}</div>`;
}

function checkEnigme4() {
  const raw = document.getElementById('answer4').value.trim().toLowerCase().replace(/[^a-z]/g, '');
  const fb = document.getElementById('feedback4');
  attempts[4]++;

  if (raw === 'callmeludo') {
    fb.textContent = 'üéâ AFFAIRE R√âSOLUE ! Le coffre s\'ouvre...';
    fb.className = 'feedback success';
    indicesFound = 4;
    document.getElementById('dot4').classList.add('found');
    updateProgress();
    disableInput('answer4');
    setTimeout(showFinale, 2500);
  } else if (raw.includes('call') && raw.includes('ludo')) {
    fb.textContent = 'üî• Presque ! Trois mots : "Call ... Ludo"';
    fb.className = 'feedback hint';
  } else if (raw.includes('call')) {
    fb.textContent = 'üî• "Call..." c\'est le d√©but ! Compl√©tez avec les autres fragments.';
    fb.className = 'feedback hint';
  } else {
    if (attempts[4] >= 5) {
      fb.textContent = 'üí° Les lettres visibles forment : C-A-L-L  M-E  L-_-_-_. Compl√©tez le dernier mot !';
    } else if (attempts[4] >= 3) {
      fb.textContent = '‚ùå Lisez les lettres en couleur de gauche √† droite. Le premier mot commence par C...';
    } else {
      fb.textContent = '‚ùå Ce n\'est pas √ßa. Superposez vos 3 fragments et lisez les lettres r√©v√©l√©es.';
    }
    fb.className = 'feedback error';
  }
  document.getElementById('attempts4').textContent = 'Tentative ' + attempts[4];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HINTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showHint(num) {
  hintCounts[num]++;
  const fb = document.getElementById('feedback' + num);
  if (num === 1) {
    if (hintCounts[1] >= 4) fb.textContent = 'üí°üí° Les noms d√©chiffr√©s sont M-A-G-E et I-S-I-S.';
    else if (hintCounts[1] >= 3) fb.textContent = 'üí° ZNTR ‚Üí reculez chaque lettre de 13 : Z‚ÜíM, N‚ÜíA, T‚ÜíG, R‚ÜíE = MAGE';
    else if (hintCounts[1] >= 2) fb.textContent = 'üí° C√©sar de 13 = ROT13. Chaque lettre a son miroir : A‚ÜîN, B‚ÜîO, C‚ÜîP...';
    else fb.textContent = 'üí° Le jour de naissance = 13. C\'est le d√©calage. Reculez chaque lettre de 13 places.';
  } else if (num === 3) {
    if (hintCounts[3] >= 4) fb.textContent = 'üí°üí° C\'est LIMONADE ! Regardez bien la diagonale principale...';
    else if (hintCounts[3] >= 3) fb.textContent = 'üí° C\'est une boisson p√©tillante et sucr√©e qu\'on adore boire bien fra√Æche.';
    else if (hintCounts[3] >= 2) fb.textContent = 'üí° 8 lettres. Commence par L. C\'est une boisson. Pensez diagonal.';
    else fb.textContent = 'üí° Cherchez un mot de 8 lettres. Horizontal, vertical ou diagonal ‚Äî une seule direction.';
  } else if (num === 4) {
    if (hintCounts[4] >= 3) fb.textContent = 'üí°üí° C-A-L-L  M-E  L-U-D-O. Tapez "Call Me Ludo" !';
    else if (hintCounts[4] >= 2) fb.textContent = 'üí° Lettres r√©v√©l√©es : C_A_L_L  M_E  L___. Les 3 derni√®res lettres forment un pr√©nom.';
    else fb.textContent = 'üí° Superposez les 3 fragments. Lisez les lettres en couleur de gauche √† droite.';
  }
  fb.className = 'feedback hint';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ENTER KEY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    const id = document.activeElement.id;
    if (id === 'answer1') checkEnigme1();
    else if (id === 'answer3') checkEnigme3();
    else if (id === 'answer4') checkEnigme4();
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FINALE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showFinale() {
  document.querySelectorAll('.enquete-section').forEach(s => { s.classList.remove('active'); s.style.display = 'none'; });
  document.getElementById('finale').classList.add('active');
  document.getElementById('progressBar').style.width = '100%';
  createConfetti(); createHearts();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function createConfetti() {
  const c = document.getElementById('confettiContainer');
  const colors = ['#c0392b','#d4a843','#e8c97a','#52b788','#fca3ad','#ffb9af','#ffd7a0'];
  for (let i = 0; i < 60; i++) {
    const el = document.createElement('div'); el.className = 'confetti';
    el.style.left = Math.random()*100+'%';
    el.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
    el.style.animationDuration = (3+Math.random()*4)+'s';
    el.style.animationDelay = Math.random()*3+'s';
    el.style.width = (5+Math.random()*10)+'px';
    el.style.height = (5+Math.random()*10)+'px';
    el.style.borderRadius = Math.random()>0.5?'50%':'2px';
    c.appendChild(el);
  }
}
function createHearts() {
  const f = document.getElementById('finale');
  const e = ['‚ù§Ô∏è','üíï','üé≠','üîç','‚ú®','üåπ','üå∫'];
  for (let i = 0; i < 10; i++) {
    const h = document.createElement('div'); h.className = 'heart-float';
    h.textContent = e[Math.floor(Math.random()*e.length)];
    h.style.left = Math.random()*90+5+'%';
    h.style.top = Math.random()*80+10+'%';
    h.style.animationDelay = Math.random()*4+'s';
    h.style.fontSize = (1+Math.random()*1.5)+'rem';
    f.appendChild(h);
  }
}
</script>
</body>
</html>
