<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ” Dossier ClassifiÃ© â€” Affaire nÂ°1302</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<style>
:root {
  --rose: #8b4444;
  --abricot: #d4a843;
  --corail: #c0392b;
  --sang: #8b1a1a;
  --sang-clair: #c0392b;
  --noir: #f5f5f5;
  --noir-chaud: #e8e8e8;
  --creme: #1a1a1a;
  --or: #b8860b;
  --or-pale: #8b6914;
  --teal: #2a8a84;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; overflow-x: hidden; }
body {
  font-family: 'Crimson Pro', Georgia, serif;
  background: #ffffff; color: #1a1a1a;
  min-height: 100vh; overflow-x: hidden;
}

/* â•â•â•â•â•â• INTRO â•â•â•â•â•â• */
#intro-screen {
  position: fixed; inset: 0; z-index: 1000; background: var(--noir);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  cursor: pointer; transition: opacity 1.2s ease, transform 1.2s ease;
}
#intro-screen.fade-out { opacity: 0; transform: scale(1.1); pointer-events: none; }
.stamp-classified {
  font-family: 'Special Elite', monospace; font-size: clamp(2rem, 6vw, 4.5rem);
  color: var(--sang-clair); border: 4px solid var(--sang-clair);
  padding: 0.3em 0.8em; transform: rotate(-8deg);
  letter-spacing: 0.15em; text-transform: uppercase;
  animation: stamp-appear 0.6s cubic-bezier(0.17, 0.67, 0.29, 1.2) forwards;
  opacity: 0; text-shadow: 2px 2px 4px rgba(139, 26, 26, 0.4);
}
@keyframes stamp-appear {
  0% { opacity: 0; transform: rotate(-8deg) scale(3); }
  60% { opacity: 1; transform: rotate(-8deg) scale(0.95); }
  100% { opacity: 1; transform: rotate(-8deg) scale(1); }
}
.dossier-number {
  font-family: 'Special Elite', monospace; font-size: clamp(1rem, 3vw, 1.6rem);
  color: var(--or-pale); margin-top: 1.5rem; letter-spacing: 0.3em;
  opacity: 0; animation: fade-in 1s ease 0.8s forwards;
}
.intro-instruction {
  font-family: 'Crimson Pro', serif; font-size: clamp(0.85rem, 2vw, 1.1rem);
  color: rgba(26,26,26,0.6); margin-top: 3rem; letter-spacing: 0.15em;
  opacity: 0; animation: pulse-fade 2s ease 1.5s infinite;
}
@keyframes fade-in { to { opacity: 1; } }
@keyframes pulse-fade { 0%,100% { opacity: 0.3; } 50% { opacity: 0.7; } }

/* â•â•â•â•â•â• MAIN â•â•â•â•â•â• */
#main-content { opacity: 0; transition: opacity 1s ease; }
#main-content.visible { opacity: 1; }

/* â•â•â•â•â•â• SCÃˆNE DE CRIME â•â•â•â•â•â• */
.crime-scene {
  min-height: 100vh; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 2rem; position: relative;
  background:
    radial-gradient(ellipse at 20% 80%, rgba(252,163,173,0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 20%, rgba(255,215,160,0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(139,26,26,0.15) 0%, transparent 70%),
    var(--noir);
  overflow: hidden;
}
.crime-scene::before {
  content: ''; position: absolute; inset: 0;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0v60M0 30h60' stroke='rgba(212,168,67,0.03)' stroke-width='0.5'/%3E%3C/svg%3E");
  pointer-events: none;
}
.police-tape {
  position: absolute; top: 0; left: -5%; width: 110%;
  background: repeating-linear-gradient(90deg, #e8c93a 0px, #e8c93a 80px, var(--noir) 80px, var(--noir) 100px);
  color: var(--noir); font-family: 'Special Elite', monospace; font-size: 0.85rem;
  letter-spacing: 0.3em; text-transform: uppercase; padding: 0.4em 0;
  text-align: center; transform: rotate(-1deg); z-index: 5;
  overflow: hidden; white-space: nowrap;
}
.police-tape span { display: inline-block; animation: scroll-tape 20s linear infinite; }
@keyframes scroll-tape { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

.crime-title {
  font-family: 'Playfair Display', serif; font-size: clamp(2rem, 7vw, 5rem);
  font-weight: 700; text-align: center; line-height: 1.15;
  margin-bottom: 0.5em; position: relative; z-index: 2;
}
.crime-title .line1 { display: block; color: var(--rose); font-style: italic; font-weight: 400; font-size: 0.5em; letter-spacing: 0.2em; text-transform: uppercase; }
.crime-title .line2 { display: block; background: linear-gradient(135deg, var(--corail), var(--rose), var(--abricot)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.crime-title .line3 { display: block; color: var(--sang-clair); font-size: 0.4em; font-family: 'Special Elite', monospace; letter-spacing: 0.25em; margin-top: 0.3em; }
.crime-date { font-family: 'Special Elite', monospace; color: var(--or-pale); font-size: clamp(0.9rem, 2vw, 1.2rem); letter-spacing: 0.15em; margin-bottom: 2rem; z-index: 2; }
.crime-narrative {
  max-width: 700px; text-align: center; font-size: clamp(1rem, 2.5vw, 1.25rem);
  line-height: 1.8; color: rgba(26,26,26,0.9); z-index: 2;
  margin-bottom: 2.5rem; font-weight: 300;
}
.crime-narrative em { color: var(--corail); font-weight: 400; }
.crime-narrative strong { color: var(--or-pale); font-weight: 600; }
.btn-enquete {
  font-family: 'Special Elite', monospace; font-size: clamp(1rem, 2.5vw, 1.3rem);
  color: var(--noir); background: linear-gradient(135deg, var(--abricot), var(--or-pale));
  border: none; padding: 0.8em 2.5em; cursor: pointer;
  letter-spacing: 0.15em; text-transform: uppercase; z-index: 2;
  transition: all 0.3s; clip-path: polygon(3% 0%, 100% 0%, 97% 100%, 0% 100%);
}
.btn-enquete:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(212,168,67,0.3); }

/* â•â•â•â•â•â• ENQUÃŠTE SECTIONS â•â•â•â•â•â• */
.enquete-section { display: none; padding: 2rem 1rem; max-width: 800px; margin: 0 auto; }
.enquete-section.active { display: block; animation: section-in 0.8s ease forwards; }
@keyframes section-in { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

.evidence-card {
  background: linear-gradient(145deg, rgba(44,24,16,0.9), rgba(26,26,26,0.95));
  border: 1px solid rgba(212,168,67,0.2); border-radius: 2px;
  padding: 2rem; margin: 2rem 0; position: relative; overflow: hidden;
}
.evidence-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: linear-gradient(to bottom, var(--corail), var(--sang-clair)); }
.evidence-card::after { content: 'PIÃˆCE Ã€ CONVICTION'; position: absolute; top: 0.8rem; right: 1rem; font-family: 'Special Elite', monospace; font-size: 0.65rem; color: var(--or); letter-spacing: 0.2em; opacity: 0.5; }
.evidence-number { font-family: 'Special Elite', monospace; font-size: 0.8rem; color: var(--sang-clair); letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 1rem; }
.evidence-title { font-family: 'Playfair Display', serif; font-size: clamp(1.3rem, 3vw, 1.8rem); color: var(--rose); margin-bottom: 1rem; font-weight: 700; }
.evidence-text { font-size: 1.05rem; line-height: 1.8; color: rgba(26,26,26,0.85); font-weight: 300; margin-bottom: 1.5rem; }
.evidence-text em { color: var(--abricot); font-weight: 400; }

.enigme-zone {
  background: rgba(245,230,208,0.05); border: 1px dashed rgba(212,168,67,0.3);
  padding: 1.5rem; margin: 1.5rem 0; text-align: center;
}
.enigme-label { font-family: 'Special Elite', monospace; font-size: 0.75rem; color: var(--or); letter-spacing: 0.25em; text-transform: uppercase; margin-bottom: 1rem; }
.enigme-question { font-family: 'Playfair Display', serif; font-size: clamp(1.05rem, 2.5vw, 1.3rem); color: var(--creme); margin-bottom: 1.5rem; line-height: 1.6; font-style: italic; }
.input-group { display: flex; gap: 0.5rem; max-width: 450px; margin: 0 auto; flex-wrap: wrap; justify-content: center; }
.enigme-input {
  font-family: 'Special Elite', monospace; font-size: 1.1rem; padding: 0.7em 1.2em;
  background: rgba(26,26,26,0.8); border: 1px solid rgba(212,168,67,0.3);
  color: var(--creme); flex: 1; min-width: 180px; text-align: center;
  letter-spacing: 0.1em; transition: border-color 0.3s;
}
.enigme-input:focus { outline: none; border-color: var(--or-pale); box-shadow: 0 0 15px rgba(212,168,67,0.15); }
.enigme-input::placeholder { color: rgba(250,243,232,0.25); }
.btn-valider {
  font-family: 'Special Elite', monospace; font-size: 0.9rem; padding: 0.7em 1.5em;
  background: var(--sang-clair); color: var(--creme); border: none; cursor: pointer;
  letter-spacing: 0.15em; text-transform: uppercase; transition: all 0.3s;
}
.btn-valider:hover { background: var(--sang); transform: scale(1.03); }
.feedback { font-family: 'Special Elite', monospace; font-size: 0.9rem; margin-top: 1rem; min-height: 1.5em; }
.feedback.error { color: var(--sang-clair); animation: shake 0.4s ease; }
.feedback.success { color: var(--teal); }
.feedback.hint { color: var(--abricot); font-style: italic; }
@keyframes shake { 0%,100% { transform: translateX(0); } 20%,60% { transform: translateX(-5px); } 40%,80% { transform: translateX(5px); } }

.choices-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
.choice-btn {
  font-family: 'Crimson Pro', serif; font-size: 1rem; padding: 1em 1.2em;
  background: rgba(44,24,16,0.6); border: 1px solid rgba(252,163,173,0.2);
  color: var(--creme); cursor: pointer; transition: all 0.3s; text-align: left; line-height: 1.5;
}
.choice-btn:hover { background: rgba(252,163,173,0.1); border-color: var(--corail); transform: translateY(-2px); }
.choice-btn.correct { background: rgba(78,205,196,0.15); border-color: var(--teal); color: var(--teal); }
.choice-btn.wrong { background: rgba(139,26,26,0.2); border-color: var(--sang-clair); color: var(--sang-clair); opacity: 0.6; }

.indice-unlocked {
  display: none; padding: 1.5rem; margin-top: 1.5rem; text-align: center;
  background: linear-gradient(135deg, rgba(78,205,196,0.08), rgba(212,168,67,0.08));
  border: 1px solid rgba(78,205,196,0.3);
}
.indice-unlocked.show { display: block; animation: unlock-glow 1s ease; }
@keyframes unlock-glow {
  0% { box-shadow: 0 0 0 rgba(78,205,196,0); opacity: 0; transform: scale(0.95); }
  50% { box-shadow: 0 0 30px rgba(78,205,196,0.2); }
  100% { box-shadow: 0 0 0 rgba(78,205,196,0); opacity: 1; transform: scale(1); }
}
.indice-label { font-family: 'Special Elite', monospace; font-size: 0.7rem; color: var(--teal); letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 0.8rem; }
.indice-content { font-family: 'Playfair Display', serif; font-size: 1.15rem; color: var(--abricot); font-style: italic; }

.btn-continuer {
  display: none; margin: 2rem auto;
  font-family: 'Special Elite', monospace; font-size: 1rem; padding: 0.8em 2em;
  background: transparent; border: 1px solid var(--or); color: var(--or); cursor: pointer;
  letter-spacing: 0.2em; text-transform: uppercase; transition: all 0.3s;
}
.btn-continuer.show { display: block; animation: fade-in 0.5s ease forwards; }
.btn-continuer:hover { background: rgba(212,168,67,0.1); box-shadow: 0 0 20px rgba(212,168,67,0.15); }

.progress-bar {
  position: fixed; top: 0; left: 0; height: 3px;
  background: linear-gradient(90deg, var(--sang-clair), var(--corail), var(--abricot));
  z-index: 100; transition: width 0.8s cubic-bezier(0.23, 1, 0.32, 1);
  box-shadow: 0 0 10px rgba(252,163,173,0.5);
}
.indices-collectes {
  position: fixed; top: 50%; right: 0; transform: translateY(-50%);
  z-index: 50; display: flex; flex-direction: column; gap: 0.5rem; padding: 0.5rem;
}
.indice-dot {
  width: 12px; height: 12px; border-radius: 50%;
  border: 2px solid rgba(212,168,67,0.3); background: transparent; transition: all 0.5s;
}
.indice-dot.found { background: var(--or-pale); border-color: var(--or-pale); box-shadow: 0 0 8px rgba(212,168,67,0.5); }

.cipher-display {
  font-family: 'Special Elite', monospace; font-size: clamp(1rem, 3vw, 1.5rem);
  color: var(--or-pale); letter-spacing: 0.15em; margin: 1rem 0; padding: 1rem;
  background: rgba(255,255,255,0.5); border: 1px solid rgba(139,26,26,0.3); line-height: 1.8;
}
.hint-btn {
  font-family: 'Special Elite', monospace; font-size: 0.75rem; color: var(--abricot);
  background: none; border: none; cursor: pointer; letter-spacing: 0.15em;
  opacity: 0.7; transition: opacity 0.3s; margin-top: 0.5rem;
}
.hint-btn:hover { opacity: 1; text-decoration: underline; }

/* Grille de lettres 8x8 */
.letter-grid {
  display: inline-grid; grid-template-columns: repeat(8, 1fr);
  gap: 5px; margin: 1rem auto; max-width: 420px;
}
.letter-cell {
  font-family: 'Special Elite', monospace; font-size: clamp(0.9rem, 2.5vw, 1.3rem);
  width: clamp(34px, 7vw, 46px); height: clamp(34px, 7vw, 46px);
  display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.6); border: 1px solid rgba(139,26,26,0.3);
  color: var(--or-pale); transition: all 0.3s; user-select: none; cursor: pointer;
}
.letter-cell:hover { border-color: var(--corail); }
.letter-cell.highlight { border-color: var(--corail); color: var(--corail); background: rgba(192,57,43,0.15); }
.letter-cell.dim { opacity: 0.3; }
.letter-cell.path-reveal { border-color: var(--teal); color: var(--teal); background: rgba(42,138,132,0.15); }

.suspect-table {
  width: 100%; border-collapse: collapse; margin: 1rem 0;
  font-family: 'Crimson Pro', serif; font-size: 0.95rem;
}
.suspect-table th {
  font-family: 'Special Elite', monospace; font-size: 0.7rem;
  color: var(--or); letter-spacing: 0.2em; text-transform: uppercase;
  padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(139,26,26,0.3); text-align: left;
}
.suspect-table td {
  padding: 0.7rem 0.5rem; border-bottom: 1px solid rgba(139,26,26,0.08);
  color: rgba(26,26,26,0.85); vertical-align: top;
}
.suspect-table tr:hover td { background: rgba(192,57,43,0.05); }
.attempt-counter { font-family: 'Special Elite', monospace; font-size: 0.75rem; color: rgba(26,26,26,0.4); margin-top: 0.5rem; }

.blood-drip {
  position: absolute; width: 3px;
  background: linear-gradient(to bottom, var(--sang-clair), transparent);
  top: 0; animation: drip 4s ease-in infinite; opacity: 0.3;
}
@keyframes drip { 0% { height: 0; opacity: 0.3; } 70% { height: 80px; opacity: 0.3; } 100% { height: 100px; opacity: 0; } }

/* â•â•â•â•â•â• FINALE â•â•â•â•â•â• */
#finale { display: none; min-height: 100vh; position: relative; overflow: hidden; }
#finale.active {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 2rem; animation: finale-in 1.5s ease forwards;
}
@keyframes finale-in { from { opacity: 0; } to { opacity: 1; } }
.finale-bg {
  position: absolute; inset: 0;
  background:
    radial-gradient(ellipse at 30% 40%, rgba(255,185,175,0.15) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 60%, rgba(255,215,160,0.1) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 80%, rgba(252,163,173,0.12) 0%, transparent 40%),
    #ffffff;
}
.confetti-container { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
.confetti { position: absolute; width: 10px; height: 10px; top: -10px; animation: confetti-fall linear infinite; }
@keyframes confetti-fall { 0% { transform: translateY(-10px) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
.finale-content { position: relative; z-index: 2; text-align: center; max-width: 700px; }
.finale-badge {
  display: inline-block; font-family: 'Special Elite', monospace; font-size: 0.75rem;
  color: var(--teal); letter-spacing: 0.4em; text-transform: uppercase;
  border: 1px solid rgba(42,138,132,0.6); padding: 0.4em 1.5em; margin-bottom: 2rem;
  animation: pulse-border 2s ease infinite;
}
@keyframes pulse-border { 0%,100% { border-color: rgba(42,138,132,0.6); } 50% { border-color: rgba(42,138,132,0.9); } }
.finale-title {
  font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 8vw, 5rem);
  font-weight: 700; line-height: 1.1; margin-bottom: 1rem;
  background: linear-gradient(135deg, var(--rose), var(--abricot), var(--corail), var(--or-pale));
  background-size: 200% 200%;
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  animation: gradient-shift 4s ease infinite;
}
@keyframes gradient-shift { 0%,100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
.finale-subtitle { font-family: 'Playfair Display', serif; font-size: clamp(1.3rem, 3vw, 1.8rem); font-style: italic; color: var(--rose); margin-bottom: 2.5rem; font-weight: 400; }
.cadeau-reveal {
  background: linear-gradient(145deg, rgba(240,240,240,0.95), rgba(255,255,255,0.9));
  border: 2px solid var(--or); padding: 2.5rem; margin: 1.5rem auto;
  position: relative; max-width: 550px;
}
.cadeau-reveal::before { content: 'ğŸ­'; position: absolute; top: -1.2rem; left: 50%; transform: translateX(-50%); font-size: 2rem; background: #ffffff; padding: 0 0.5em; }
.cadeau-label { font-family: 'Special Elite', monospace; font-size: 0.7rem; color: var(--or); letter-spacing: 0.4em; text-transform: uppercase; margin-bottom: 1.5rem; }
.cadeau-titre { font-family: 'Playfair Display', serif; font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 700; color: var(--abricot); margin-bottom: 0.5rem; line-height: 1.2; }
.cadeau-details { font-family: 'Crimson Pro', serif; font-size: 1.2rem; color: var(--rose); margin-bottom: 0.3rem; font-weight: 300; }
.cadeau-date { font-family: 'Special Elite', monospace; font-size: 1.3rem; color: var(--or-pale); margin-top: 1rem; letter-spacing: 0.1em; }
.finale-message {
  font-family: 'Crimson Pro', serif; font-size: clamp(1.05rem, 2.5vw, 1.25rem);
  color: rgba(26,26,26,0.9); line-height: 1.8; margin-top: 2.5rem;
  font-weight: 300; max-width: 550px; margin-left: auto; margin-right: auto;
}
.finale-message em { color: var(--corail); font-weight: 400; }
.signature { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-style: italic; color: var(--abricot); margin-top: 2rem; }
.heart-float { position: absolute; font-size: 1.5rem; animation: float-heart 6s ease-in-out infinite; opacity: 0.3; }
@keyframes float-heart { 0%,100% { transform: translateY(0) rotate(0deg); opacity: 0.2; } 50% { transform: translateY(-30px) rotate(15deg); opacity: 0.5; } }

@media (max-width: 600px) {
  .evidence-card { padding: 1.2rem; }
  .evidence-card::after { display: none; }
  .enigme-zone { padding: 1rem; }
  .cadeau-reveal { padding: 1.5rem; }
  .indices-collectes { display: none; }
  .choices-grid { grid-template-columns: 1fr; }
  .suspect-table { font-size: 0.85rem; }
  .letter-grid { gap: 3px; }
}
</style>
</head>
<body>

<!-- INTRO -->
<div id="intro-screen" onclick="openDossier()">
  <div class="stamp-classified">CLASSIFIÃ‰</div>
  <div class="dossier-number">Dossier nÂ°13-02 â€” Brigade Criminelle des Antilles</div>
  <div class="intro-instruction">â–¸ Cliquez pour ouvrir le dossier â—‚</div>
</div>

<div class="progress-bar" id="progressBar" style="width: 0%"></div>
<div class="indices-collectes">
  <div class="indice-dot" id="dot1"></div>
  <div class="indice-dot" id="dot2"></div>
  <div class="indice-dot" id="dot3"></div>
  <div class="indice-dot" id="dot4"></div>
</div>

<div id="main-content">

  <!-- â•â•â•â•â•â• SCÃˆNE DE CRIME â•â•â•â•â•â• -->
  <section class="crime-scene" id="scene">
    <div class="police-tape">
      <span>âš  SCÃˆNE DE CRIME â€” NE PAS FRANCHIR âš  SCÃˆNE DE CRIME â€” NE PAS FRANCHIR âš  SCÃˆNE DE CRIME â€” NE PAS FRANCHIR âš  SCÃˆNE DE CRIME â€” NE PAS FRANCHIR âš &nbsp;&nbsp;&nbsp;</span>
    </div>
    <div class="blood-drip" style="left: 15%;"></div>
    <div class="blood-drip" style="left: 45%; animation-delay: 1.5s;"></div>
    <div class="blood-drip" style="left: 78%; animation-delay: 3s;"></div>

    <h1 class="crime-title">
      <span class="line1">Affaire non rÃ©solue</span>
      <span class="line2">Meurtre MystÃ©rieux<br>Ã  la Saint-Valentin</span>
      <span class="line3">Fort-de-France â€” 13 fÃ©vrier 2026 â€” 23h59</span>
    </h1>
    <p class="crime-date">ğŸ“‚ AgentÂ·e assignÃ©Â·e : Inspectrice Syssine</p>
    <div class="crime-narrative">
      <p>La nuit du <strong>13 fÃ©vrier</strong>, Ã  la veille de la Saint-Valentin, un crime passionnel a Ã©tÃ© commis sur la Savane de Fort-de-France. L'<em>Amour</em> a Ã©tÃ© retrouvÃ© sans vie au pied de la statue de l'ImpÃ©ratrice JosÃ©phine.</p>
      <br>
      <p>Deux tÃ©moins fÃ©lins ont Ã©tÃ© aperÃ§us sur les lieux. Quatre suspects martiniquais ont Ã©tÃ© arrÃªtÃ©s. Tous mentent, sauf un.</p>
      <br>
      <p>Tous les enquÃªteurs de la Brigade ont Ã©chouÃ©. <em>Vous Ãªtes notre dernier espoir, Inspectrice.</em></p>
    </div>
    <button class="btn-enquete" onclick="startEnquete()">ğŸ” Ouvrir l'enquÃªte</button>
  </section>

  <!-- â•â•â•â•â•â• Ã‰NIGME 1 â€” CHIFFRE DE CÃ‰SAR â•â•â•â•â•â• -->
  <section class="enquete-section" id="enigme1">
    <div class="evidence-card">
      <div class="evidence-number">PiÃ¨ce Ã  conviction nÂ°1</div>
      <div class="evidence-title">Le Billet ChiffrÃ© de Manman Dlo</div>
      <div class="evidence-text">
        Un billet froissÃ© a Ã©tÃ© retrouvÃ© dans la fontaine de la Place de la Savane, flottant entre deux nÃ©nuphars. L'Ã©criture est celle de <em>Manman Dlo</em>, la sirÃ¨ne gardienne des eaux martiniquaises. Elle a chiffrÃ© le nom des deux tÃ©moins fÃ©lins Ã  l'aide d'un <em>chiffre de CÃ©sar</em>.<br><br>
        L'indice laissÃ© par Manman Dlo : <em>Â« La clÃ© se trouve dans le jour de naissance de celle qui enquÃªte. Â»</em>
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">ğŸ” Message interceptÃ©</div>
        <div class="cipher-display" id="cipher1"></div>
        <div class="enigme-question">
          DÃ©chiffrez les noms des deux tÃ©moins fÃ©lins.<br>
          <small style="color: var(--or); opacity: 0.5;">Le chiffre de CÃ©sar dÃ©cale chaque lettre dans l'alphabet.</small>
        </div>
        <div class="input-group">
          <input type="text" class="enigme-input" id="answer1" placeholder="Les deux noms..." autocomplete="off" spellcheck="false">
          <button class="btn-valider" onclick="checkEnigme1()">DÃ©chiffrer</button>
        </div>
        <button class="hint-btn" onclick="showHint(1)">ğŸ’¡ Besoin d'un indice ?</button>
        <div class="feedback" id="feedback1"></div>
        <div class="attempt-counter" id="attempts1"></div>
      </div>

      <div class="indice-unlocked" id="indice1">
        <div class="indice-label">ğŸ— Fragment nÂ°1 dÃ©bloquÃ©</div>
        <div class="indice-content">C _ _ _&ensp;&ensp;_ _&ensp;&ensp;_ _ _ _</div>
      </div>
    </div>
    <button class="btn-continuer" id="btn-next1" onclick="goTo('enigme2')">PiÃ¨ce Ã  conviction suivante â†’</button>
  </section>

  <!-- â•â•â•â•â•â• Ã‰NIGME 2 â€” DÃ‰DUCTION LOGIQUE â•â•â•â•â•â• -->
  <section class="enquete-section" id="enigme2">
    <div class="evidence-card">
      <div class="evidence-number">PiÃ¨ce Ã  conviction nÂ°2</div>
      <div class="evidence-title">Le TÃ©moignage de Ti-Jean</div>
      <div class="evidence-text">
        Le lÃ©gendaire <em>Ti-Jean</em>, hÃ©ros rusÃ© des contes crÃ©oles, a interrogÃ© les quatre suspects. Chacun fait exactement <em>une dÃ©claration vraie et une fausse</em>. Ã€ vous de dÃ©mÃªler le vrai du faux, Inspectrice.
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">ğŸ“‹ ProcÃ¨s-verbaux d'interrogatoire</div>

        <table class="suspect-table">
          <tr><th>Suspect</th><th>DÃ©claration 1</th><th>DÃ©claration 2</th></tr>
          <tr>
            <td style="color: var(--corail); font-weight: 600;">ğŸ BÃªte Ã  Man IbÃ¨</td>
            <td>Â« Le crime a eu lieu sur la plage des Salines. Â»</td>
            <td>Â« La Diablesse portait des chaussures rouges. Â»</td>
          </tr>
          <tr>
            <td style="color: var(--corail); font-weight: 600;">ğŸ‘  La Diablesse</td>
            <td>Â« Je portais des chaussures blanches. Â»</td>
            <td>Â« La BÃªte Ã  Man IbÃ¨ Ã©tait chez le Dorlis. Â»</td>
          </tr>
          <tr>
            <td style="color: var(--corail); font-weight: 600;">ğŸŒ™ Le Dorlis</td>
            <td>Â« La BÃªte Ã  Man IbÃ¨ n'Ã©tait pas chez moi. Â»</td>
            <td>Â« Le crime a eu lieu sur la Savane. Â»</td>
          </tr>
          <tr>
            <td style="color: var(--corail); font-weight: 600;">ğŸ”¥ Le Volcan</td>
            <td>Â« La Diablesse portait des chaussures rouges. Â»</td>
            <td>Â« J'ai vu le Dorlis sur la plage des Salines. Â»</td>
          </tr>
        </table>

        <div class="enigme-question" style="margin-top: 1.5rem;">
          On sait que le crime a eu lieu <strong>sur la Savane</strong>, pas sur la plage.<br><br>
          D'aprÃ¨s vos dÃ©ductions : <strong>de quelle couleur Ã©taient les chaussures de la Diablesse ?</strong>
        </div>

        <div class="choices-grid" id="choices2">
          <button class="choice-btn" onclick="checkEnigme2(this, 'rouge')">ğŸ”´ Rouges</button>
          <button class="choice-btn" onclick="checkEnigme2(this, 'blanc')">âšª Blanches</button>
          <button class="choice-btn" onclick="checkEnigme2(this, 'noir')">âš« Noires</button>
          <button class="choice-btn" onclick="checkEnigme2(this, 'or')">ğŸŸ¡ DorÃ©es</button>
        </div>
        <div class="feedback" id="feedback2"></div>
      </div>

      <div class="indice-unlocked" id="indice2">
        <div class="indice-label">ğŸ— Fragment nÂ°2 dÃ©bloquÃ©</div>
        <div class="indice-content">_ _ L L&ensp;&ensp;M _&ensp;&ensp;_ _ _ _</div>
      </div>
    </div>
    <button class="btn-continuer" id="btn-next2" onclick="goTo('enigme3')">PiÃ¨ce Ã  conviction suivante â†’</button>
  </section>

  <!-- â•â•â•â•â•â• Ã‰NIGME 3 â€” GRILLE DE MOTS â•â•â•â•â•â• -->
  <section class="enquete-section" id="enigme3">
    <div class="evidence-card">
      <div class="evidence-number">PiÃ¨ce Ã  conviction nÂ°3</div>
      <div class="evidence-title">La Grille du Quimboiseur</div>
      <div class="evidence-text">
        Le <em>Quimboiseur</em> du Morne-Rouge a gravÃ© une grille de lettres sur un mur de la scÃ¨ne de crime. Il affirme qu'un <em>mot secret de 8 lettres</em> est dissimulÃ© Ã  l'intÃ©rieur â€” comme dans un jeu de mots mÃªlÃ©s, les lettres sont alignÃ©es en ligne droite : horizontale, verticale ou diagonale. Attention aux fausses pistes.
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">ğŸ”® La grille ensorcelÃ©e</div>
        <div class="letter-grid" id="letterGrid"></div>
        <div style="font-size: 0.8rem; color: var(--or); opacity: 0.4; margin: 0.5rem 0;">Cliquez les lettres dans l'ordre ou tapez directement.</div>
        <div class="enigme-question">
          Quel mot de 8 lettres se cache dans cette grille ?
        </div>
        <div class="input-group">
          <input type="text" class="enigme-input" id="answer3" placeholder="Le mot secret..." autocomplete="off" maxlength="12" spellcheck="false">
          <button class="btn-valider" onclick="checkEnigme3()">VÃ©rifier</button>
        </div>
        <button class="hint-btn" onclick="showHint(3)">ğŸ’¡ Besoin d'un indice ?</button>
        <div class="feedback" id="feedback3"></div>
      </div>

      <div class="indice-unlocked" id="indice3">
        <div class="indice-label">ğŸ— Fragment nÂ°3 dÃ©bloquÃ©</div>
        <div class="indice-content">_ A _ _&ensp;&ensp;_ E&ensp;&ensp;L _ _ _</div>
      </div>
    </div>
    <button class="btn-continuer" id="btn-next3" onclick="goTo('enigme4')">DerniÃ¨re piÃ¨ce Ã  conviction â†’</button>
  </section>

  <!-- â•â•â•â•â•â• Ã‰NIGME 4 â€” RECONSTITUTION FINALE â•â•â•â•â•â• -->
  <section class="enquete-section" id="enigme4">
    <div class="evidence-card">
      <div class="evidence-number">PiÃ¨ce Ã  conviction nÂ°4 â€” Finale</div>
      <div class="evidence-title">Le Coffre de l'Habitation ClÃ©ment</div>
      <div class="evidence-text">
        Un ancien coffre colonial a Ã©tÃ© dÃ©couvert dans les caves de l'<em>Habitation ClÃ©ment</em>. Ã€ l'intÃ©rieur, un parchemin porte les trois fragments que vous avez collectÃ©s. Assemblez-les pour reconstituer le <em>nom secret</em> que cache cette affaire.
      </div>

      <div class="enigme-zone">
        <div class="enigme-label">ğŸ— Vos trois fragments superposÃ©s</div>
        <div id="fragmentsDisplay"></div>

        <div class="enigme-question">
          Â« <em>Le premier fragment rÃ©vÃ¨le le dÃ©but.<br>
          Le deuxiÃ¨me fragment rÃ©vÃ¨le le cÅ“ur.<br>
          Le troisiÃ¨me fragment rÃ©vÃ¨le la fin.</em> Â»<br><br>
          Reconstituez le nom complet. Trois mots.
        </div>
        <div class="input-group">
          <input type="text" class="enigme-input" id="answer4" placeholder="Le secret..." autocomplete="off" spellcheck="false">
          <button class="btn-valider" onclick="checkEnigme4()">Ouvrir le coffre</button>
        </div>
        <button class="hint-btn" onclick="showHint(4)">ğŸ’¡ Dernier indice ?</button>
        <div class="feedback" id="feedback4"></div>
        <div class="attempt-counter" id="attempts4"></div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â• FINALE â•â•â•â•â•â• -->
  <section id="finale">
    <div class="finale-bg"></div>
    <div class="confetti-container" id="confettiContainer"></div>
    <div class="finale-content">
      <div class="finale-badge">âœ¦ AFFAIRE CLASSÃ‰E âœ¦</div>
      <h2 class="finale-title">Joyeux Anniversaire Syssine !</h2>
      <p class="finale-subtitle">L'enquÃªtrice la plus brillante des Antilles ğŸ”</p>

      <div class="cadeau-reveal">
        <div class="cadeau-label">âœ¦ TON CADEAU D'ANNIVERSAIRE âœ¦</div>
        <div class="cadeau-titre">ğŸ­ Call Me Ludo</div>
        <div class="cadeau-details">Spectacle vivant</div>
        <div class="cadeau-date">ğŸ“… 1er Avril 2026</div>
      </div>

      <div class="finale-message">
        <p>Ma chÃ¨re Jessie,</p>
        <br>
        <p>Tu pensais rÃ©soudre un crime, mais c'Ã©tait en fait une <em>dÃ©claration d'amitiÃ©</em> dÃ©guisÃ©e en enquÃªte policiÃ¨re. ğŸ•µï¸â€â™€ï¸</p>
        <br>
        <p>Pour tes <strong style="color: var(--or-pale);">annÃ©es de folie, de rire et de complicitÃ©</strong>, tu mÃ©rites une soirÃ©e aussi extraordinaire que toi.</p>
        <br>
        <p>PrÃ©pare-toi pour le <strong style="color: var(--or-pale);">1er avril 2026</strong> â€” et non, ce n'est <em>pas</em> un poisson d'avril. ğŸŸğŸ˜‰</p>
        <br>
        <p class="signature">C'est ce que mÃ©rite une Queen Badass comme toi ! ğŸ‘‘ğŸ”¥</p>
      </div>
    </div>
  </section>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let indicesFound = 0;
let hintCounts = {1:0, 2:0, 3:0, 4:0};
let attempts = {1:0, 4:0};
let fragmentsRevealed = [false, false, false];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENIGME 1 â€” CÃ©sar shift=13
// "MAGE ET ISIS" â†’ shift each letter +13:
// M(12)+13=Z(25), A(0)+13=N(13), G(6)+13=T(19), E(4)+13=R(17) â†’ ZNTR
// E(4)+13=R(17), T(19)+13=G(6) â†’ RG
// I(8)+13=V(21), S(18)+13=F(5), I(8)+13=V(21), S(18)+13=F(5) â†’ VFVF
// Encrypted: "ZNTR RG VFVF"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CIPHER_TEXT = "ZNTR  RG  VFVF";
const CLEAR_TEXT = "MAGE ET ISIS";

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('cipher1').textContent = CIPHER_TEXT;
  buildLetterGrid();
});

// â•â•â•â•â•â• INTRO â•â•â•â•â•â•
function openDossier() {
  const intro = document.getElementById('intro-screen');
  intro.classList.add('fade-out');
  setTimeout(() => { intro.style.display = 'none'; document.getElementById('main-content').classList.add('visible'); }, 1200);
}

// â•â•â•â•â•â• NAV â•â•â•â•â•â•
function startEnquete() {
  document.getElementById('scene').style.display = 'none';
  document.getElementById('enigme1').classList.add('active');
  updateProgress();
}
function goTo(id) {
  document.querySelectorAll('.enquete-section').forEach(s => { s.classList.remove('active'); s.style.display = 'none'; });
  const t = document.getElementById(id);
  t.style.display = 'block'; void t.offsetWidth; t.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
  updateProgress();
  if (id === 'enigme4') renderFragments();
}
function updateProgress() { document.getElementById('progressBar').style.width = (indicesFound / 4 * 100) + '%'; }
function unlockIndice(n) {
  indicesFound++;
  fragmentsRevealed[n - 1] = true;
  document.getElementById('indice' + n).classList.add('show');
  document.getElementById('dot' + n).classList.add('found');
  const btn = document.getElementById('btn-next' + n);
  if (btn) btn.classList.add('show');
  updateProgress();
}
function disableInput(id) {
  const inp = document.getElementById(id);
  inp.disabled = true; inp.style.opacity = '0.5';
  const btn = inp.parentElement.querySelector('.btn-valider');
  if (btn) { btn.disabled = true; btn.style.opacity = '0.5'; }
}

// â•â•â•â•â•â• Ã‰NIGME 1 â€” CÃ©sar â•â•â•â•â•â•
function checkEnigme1() {
  const raw = document.getElementById('answer1').value.trim().toUpperCase().replace(/[^A-Z ]/g, '').replace(/\s+/g, ' ');
  const fb = document.getElementById('feedback1');
  attempts[1]++;

  if (raw === 'MAGE ET ISIS' || raw === 'MAGE ISIS' || raw === 'ISIS ET MAGE' || raw === 'ISIS MAGE') {
    fb.textContent = 'âœ… Mage & Isis ! Les deux fÃ©lins tÃ©moins sont identifiÃ©s.';
    fb.className = 'feedback success';
    unlockIndice(1);
    disableInput('answer1');
  } else if (raw.includes('MAGE') || raw.includes('ISIS')) {
    fb.textContent = 'ğŸ”¥ Vous avez trouvÃ© un des deux noms ! Il en manque un...';
    fb.className = 'feedback hint';
  } else {
    if (attempts[1] >= 5) {
      fb.textContent = 'ğŸ’¡ Zâ†’M, Nâ†’A, Tâ†’G, Râ†’E. Le premier nom est M-A-G-E...';
    } else if (attempts[1] >= 3) {
      fb.textContent = 'âŒ Chaque lettre recule de 13 positions. Z(26) - 13 = M(13)...';
    } else {
      fb.textContent = 'âŒ Pas encore. La clÃ© est le jour de naissance : le 13. DÃ©calez chaque lettre de 13 positions en arriÃ¨re.';
    }
    fb.className = 'feedback error';
  }
  document.getElementById('attempts1').textContent = 'Tentative ' + attempts[1];
}

// â•â•â•â•â•â• Ã‰NIGME 2 â€” Logique â•â•â•â•â•â•
// Raisonnement:
// FAIT: crime = Savane (pas plage)
// BÃªte: D1("plage")=FAUX â†’ D2("Diablesse chaussures rouges")=VRAI
// Diablesse: D1("blanches") â†’ si rouges=vrai â†’ D1=FAUX â†’ D2("BÃªte chez Dorlis")=VRAI
// Dorlis: D1("BÃªte PAS chez moi") â†’ si BÃªte chez Dorlis=vrai â†’ D1=FAUX â†’ D2("crime Savane")=VRAI âœ“
// Volcan: D1("rouges")=VRAI â†’ D2("Dorlis sur plage")=FAUX âœ“
// â†’ ROUGES

function checkEnigme2(btn, choice) {
  const fb = document.getElementById('feedback2');
  const all = document.querySelectorAll('#choices2 .choice-btn');
  if (choice === 'rouge') {
    btn.classList.add('correct');
    fb.innerHTML = 'âœ… Brillant ! BÃªte dit FAUX sur la plage â†’ VRAI sur les chaussures rouges. La Diablesse dit FAUX sur blanches â†’ VRAI sur "BÃªte chez Dorlis". Tout s\'enchaÃ®ne.';
    fb.className = 'feedback success';
    all.forEach(b => { if (b !== btn) b.classList.add('wrong'); b.style.pointerEvents = 'none'; });
    unlockIndice(2);
  } else {
    btn.classList.add('wrong'); btn.style.pointerEvents = 'none';
    hintCounts[2]++;
    if (choice === 'blanc') fb.textContent = 'âŒ Si blanches, la Diablesse dit vrai (D1). Alors D2 est fausse. VÃ©rifiez si tout reste cohÃ©rent avec le Dorlis...';
    else if (choice === 'noir') fb.textContent = 'âŒ Le noir n\'apparaÃ®t dans aucun tÃ©moignage. Partez de BÃªte Ã  Man IbÃ¨ : sa D1 est fausse (crime â‰  plage), donc sa D2 est...';
    else fb.textContent = 'âŒ Le dorÃ© n\'apparaÃ®t nulle part. Commencez par ce qu\'on sait : le crime = Savane. Qui ment sur Ã§a ?';
    fb.className = 'feedback error';
  }
}

// â•â•â•â•â•â• Ã‰NIGME 3 â€” Grille "LIMONADE" â•â•â•â•â•â•
// 8x8 grid. LIMONADE hidden in a zigzag non-aligned path.
// Path (row,col):
// L(0,5) â†’ I(1,3) â†’ M(2,6) â†’ O(3,4) â†’ N(4,1) â†’ A(5,7) â†’ D(6,0) â†’ E(7,5)
// Completely scattered, no alignment.

// LIMONADE on the main diagonal (0,0)â†’(7,7)
// Decoys: "LIME" starts at (0,0) horizontally but leads nowhere useful
// "MONDE" appears vertically col 2 rows 2-6 to mislead
// Several L, I, M scattered as red herrings
const GRID_LETTERS = [
  ['L','I','M','E','T','P','V','N'],
  ['D','I','F','K','H','L','B','U'],
  ['G','Q','M','E','W','O','C','R'],
  ['X','S','B','O','P','D','T','A'],
  ['H','E','J','A','N','U','K','I'],
  ['F','P','W','R','C','A','S','M'],
  ['T','B','N','G','I','L','D','F'],
  ['O','K','S','H','R','O','J','E'],
];

// Clean diagonal top-left â†’ bottom-right
const GRID_PATH = [[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7]];

function buildLetterGrid() {
  const grid = document.getElementById('letterGrid');
  if (!grid) return;
  grid.innerHTML = '';
  for (let r = 0; r < 8; r++) {
    for (let c = 0; c < 8; c++) {
      const cell = document.createElement('div');
      cell.className = 'letter-cell';
      cell.textContent = GRID_LETTERS[r][c];
      cell.dataset.row = r; cell.dataset.col = c;
      cell.addEventListener('click', () => toggleCell(cell));
      grid.appendChild(cell);
    }
  }
}

let selectedCells = [];
function toggleCell(cell) {
  if (cell.classList.contains('highlight')) {
    cell.classList.remove('highlight');
    selectedCells = selectedCells.filter(x => x.el !== cell);
  } else {
    cell.classList.add('highlight');
    selectedCells.push({ el: cell, letter: cell.textContent });
  }
  document.getElementById('answer3').value = selectedCells.map(x => x.letter).join('');
}

function checkEnigme3() {
  const answer = document.getElementById('answer3').value.trim().toUpperCase();
  const fb = document.getElementById('feedback3');

  if (answer === 'LIMONADE') {
    fb.textContent = 'âœ… LIMONADE ! Le Quimboiseur lÃ¨ve son sortilÃ¨ge. Vous avancez.';
    fb.className = 'feedback success';
    unlockIndice(3);
    disableInput('answer3');
    // Reveal path
    const grid = document.getElementById('letterGrid');
    const cells = grid.querySelectorAll('.letter-cell');
    cells.forEach(cell => {
      const r = parseInt(cell.dataset.row), c = parseInt(cell.dataset.col);
      const onPath = GRID_PATH.some(p => p[0] === r && p[1] === c);
      cell.classList.remove('highlight');
      if (onPath) cell.classList.add('path-reveal');
      else cell.classList.add('dim');
    });
  } else {
    hintCounts[3]++;
    if (hintCounts[3] >= 5) {
      fb.textContent = 'ğŸ’¡ğŸ’¡ Le mot est L-I-M-O-N-A-D-E. Cherchez une diagonale !';
    } else if (hintCounts[3] >= 3) {
      fb.textContent = 'âŒ 8 lettres. Pensez Ã  une boisson rafraÃ®chissante. Commence par L, finit par E.';
    } else {
      fb.textContent = 'âŒ Ce n\'est pas le bon mot. 8 lettres â€” cherchez en horizontal, vertical ou diagonal.';
    }
    fb.className = 'feedback error';
  }
}

// â•â•â•â•â•â• Ã‰NIGME 4 â€” Reconstitution â•â•â•â•â•â•
// "CALL ME LUDO" = C A L L   M E   L U D O
// Fragment 1: C _ _ _   _ _   _ _ _ _  (only C)
// Fragment 2: _ _ L L   M _   _ _ _ _  (L, L, M)
// Fragment 3: _ A _ _   _ E   L _ _ _  (A, E, L)
// Missing after all 3: U, D, O (last 3 of LUDO)

function renderFragments() {
  const display = document.getElementById('fragmentsDisplay');
  if (!display) return;
  //           C  A  L  L     M  E     L  U  D  O
  const full = ['C','A','L','L',' ','M','E',' ','L','U','D','O'];
  const m1 =   [ 1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0];
  const m2 =   [ 0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0];
  const m3 =   [ 0,  1,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0];

  let html = full.map((ch, i) => {
    if (ch === ' ') return '&ensp;&ensp;';
    let show = false;
    if (fragmentsRevealed[0] && m1[i]) show = true;
    if (fragmentsRevealed[1] && m2[i]) show = true;
    if (fragmentsRevealed[2] && m3[i]) show = true;
    return show
      ? `<span style="color:var(--teal);font-weight:600;">${ch}</span>`
      : `<span style="color:var(--sang-clair);">_</span>`;
  }).join(' ');

  display.innerHTML = `<div class="cipher-display" style="font-size:clamp(1.4rem,4vw,2.2rem);letter-spacing:0.25em;">${html}</div>`;
}

function checkEnigme4() {
  const raw = document.getElementById('answer4').value.trim().toLowerCase().replace(/[^a-z]/g, '');
  const fb = document.getElementById('feedback4');
  attempts[4]++;

  if (raw === 'callmeludo') {
    fb.textContent = 'ğŸ‰ AFFAIRE RÃ‰SOLUE ! Le coffre s\'ouvre...';
    fb.className = 'feedback success';
    indicesFound = 4;
    document.getElementById('dot4').classList.add('found');
    updateProgress();
    disableInput('answer4');
    setTimeout(showFinale, 2500);
  } else if (raw.includes('call') && raw.includes('ludo')) {
    fb.textContent = 'ğŸ”¥ Presque ! Trois mots : "Call ... Ludo"';
    fb.className = 'feedback hint';
  } else if (raw.includes('call')) {
    fb.textContent = 'ğŸ”¥ "Call..." c\'est le dÃ©but ! ComplÃ©tez avec les autres fragments.';
    fb.className = 'feedback hint';
  } else {
    if (attempts[4] >= 5) {
      fb.textContent = 'ğŸ’¡ Les lettres visibles forment : C-A-L-L  M-E  L-_-_-_. ComplÃ©tez le dernier mot !';
    } else if (attempts[4] >= 3) {
      fb.textContent = 'âŒ Lisez les lettres en couleur de gauche Ã  droite. Le premier mot commence par C...';
    } else {
      fb.textContent = 'âŒ Ce n\'est pas Ã§a. Superposez vos 3 fragments et lisez les lettres rÃ©vÃ©lÃ©es.';
    }
    fb.className = 'feedback error';
  }
  document.getElementById('attempts4').textContent = 'Tentative ' + attempts[4];
}

// â•â•â•â•â•â• HINTS â•â•â•â•â•â•
function showHint(num) {
  hintCounts[num]++;
  const fb = document.getElementById('feedback' + num);
  if (num === 1) {
    if (hintCounts[1] >= 4) fb.textContent = 'ğŸ’¡ğŸ’¡ Les noms dÃ©chiffrÃ©s sont M-A-G-E et I-S-I-S.';
    else if (hintCounts[1] >= 3) fb.textContent = 'ğŸ’¡ ZNTR â†’ reculez chaque lettre de 13 : Zâ†’M, Nâ†’A, Tâ†’G, Râ†’E = MAGE';
    else if (hintCounts[1] >= 2) fb.textContent = 'ğŸ’¡ CÃ©sar de 13 = ROT13. Chaque lettre a son miroir : Aâ†”N, Bâ†”O, Câ†”P...';
    else fb.textContent = 'ğŸ’¡ Le jour de naissance = 13. C\'est le dÃ©calage. Reculez chaque lettre de 13 places.';
  } else if (num === 3) {
    if (hintCounts[3] >= 4) fb.textContent = 'ğŸ’¡ğŸ’¡ C\'est LIMONADE ! Regardez bien la diagonale principale...';
    else if (hintCounts[3] >= 3) fb.textContent = 'ğŸ’¡ C\'est une boisson pÃ©tillante et sucrÃ©e qu\'on adore boire bien fraÃ®che.';
    else if (hintCounts[3] >= 2) fb.textContent = 'ğŸ’¡ 8 lettres. Commence par L. C\'est une boisson. Pensez diagonal.';
    else fb.textContent = 'ğŸ’¡ Cherchez un mot de 8 lettres. Horizontal, vertical ou diagonal â€” une seule direction.';
  } else if (num === 4) {
    if (hintCounts[4] >= 3) fb.textContent = 'ğŸ’¡ğŸ’¡ C-A-L-L  M-E  L-U-D-O. Tapez "Call Me Ludo" !';
    else if (hintCounts[4] >= 2) fb.textContent = 'ğŸ’¡ Lettres rÃ©vÃ©lÃ©es : C_A_L_L  M_E  L___. Les 3 derniÃ¨res lettres forment un prÃ©nom.';
    else fb.textContent = 'ğŸ’¡ Superposez les 3 fragments. Lisez les lettres en couleur de gauche Ã  droite.';
  }
  fb.className = 'feedback hint';
}

// â•â•â•â•â•â• ENTER KEY â•â•â•â•â•â•
document.addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    const id = document.activeElement.id;
    if (id === 'answer1') checkEnigme1();
    else if (id === 'answer3') checkEnigme3();
    else if (id === 'answer4') checkEnigme4();
  }
});

// â•â•â•â•â•â• FINALE â•â•â•â•â•â•
function showFinale() {
  document.querySelectorAll('.enquete-section').forEach(s => { s.classList.remove('active'); s.style.display = 'none'; });
  document.getElementById('finale').classList.add('active');
  document.getElementById('progressBar').style.width = '100%';
  createConfetti(); createHearts();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function createConfetti() {
  const c = document.getElementById('confettiContainer');
  const colors = ['#ffb9af','#ffd7a0','#fca3ad','#d4a843','#4ecdc4','#e8c97a'];
  for (let i = 0; i < 60; i++) {
    const el = document.createElement('div'); el.className = 'confetti';
    el.style.left = Math.random()*100+'%';
    el.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
    el.style.animationDuration = (3+Math.random()*4)+'s';
    el.style.animationDelay = Math.random()*3+'s';
    el.style.width = (5+Math.random()*10)+'px';
    el.style.height = (5+Math.random()*10)+'px';
    el.style.borderRadius = Math.random()>0.5?'50%':'2px';
    c.appendChild(el);
  }
}
function createHearts() {
  const f = document.getElementById('finale');
  const e = ['â¤ï¸','ğŸ’•','ğŸ­','ğŸ”','âœ¨','ğŸŒ¹','ğŸŒº'];
  for (let i = 0; i < 10; i++) {
    const h = document.createElement('div'); h.className = 'heart-float';
    h.textContent = e[Math.floor(Math.random()*e.length)];
    h.style.left = Math.random()*90+5+'%';
    h.style.top = Math.random()*80+10+'%';
    h.style.animationDelay = Math.random()*4+'s';
    h.style.fontSize = (1+Math.random()*1.5)+'rem';
    f.appendChild(h);
  }
}
</script>
</body>
</html>
